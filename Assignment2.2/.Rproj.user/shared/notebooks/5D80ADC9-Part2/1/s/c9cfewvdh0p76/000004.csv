"0","library(tidyverse)"
"0","get_geno_frequency <- function(geno, snp_mat){"
"0","  boolean_matrix <- snp_mat == geno"
"0","  count <- apply(boolean_matrix, 1, sum)"
"0","  freq <- count/dim(snps)[2]"
"0","  return (freq)"
"0","}"
"0","get_maf <- function(snp_mat){"
"0","  genotypes <- c(0,1,2)"
"0","  #get matrix of genotype frequencies"
"0","  geno_freq <- sapply(genotypes, get_geno_frequency, snp_mat)"
"0","  colnames(geno_freq) <- genotypes"
"0","  allele_freq <- geno_freq + geno_freq[,2]/2"
"0","  allele_freq <- allele_freq[,-2]"
"0","  maf <- apply(allele_freq, 1, min)"
"0","  return (maf)"
"0","}"
"0","pve <- function(b, b_se, maf, N){"
"0","  return("
"0","    (2*(b^2)*maf*(1-maf))/("
"0","      (2*(b^2)*maf*(1-maf)) + (b_se^2)*2*N*maf*(1-maf)"
"0","    )"
"0","  )"
"0","}"
"0","maf_df <- data.frame(""id"" = snp_ceu_20$id, ""maf"" = get_maf(snp_ceu_20))"
"0","temp_df <- data.frame(""id"" = cis_eqtls$snps)"
"0","temp_df <- merge(temp_df, maf_df, by=""id"", all.x = T)"
"0","cis_eqtls %>% arrange(snps) -> cis_eqtls"
"0","cis_eqtls$maf <- temp_df$maf"
"0","N <- dim(snp_ceu_20)[2] - 1"
"0","cis_eqtls$pve <- pve(cis_eqtls$beta, cis_eqtls$beta_se, cis_eqtls$maf, N)"
"0","hist(cis_eqtls$pve)"
